<!DOCTYPE html>
<head>
    <meta charset="utf-8">
    <title>MLB Showdown</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>âš¾</text></svg>">
      <style>
        body {
            margin: 0;
            height: 100vh;
            width: 100wh;
            overflow: scroll;
            background-color: black;
        }
        #bg-field {
            position: absolute;
            height: 1500px;
            width: 3000px;
            background-image: url('imgs/field.jpg');
            background-size: cover;
            background-repeat: no-repeat;
            border-bottom: 800px solid black;
            z-index: 0;
        }
        #dice-container {
            position: absolute;
            height: 725px;
            width: 1000px;
            top: 1575px;
            left: 1000px;
            z-index: 2;
            /* border: 1px solid white; */
        }
        .card {
            position: absolute;
            height: 240px;
            width: 160px;
            border-radius: 5px;
            cursor: pointer;
            border: 1px solid rgba(0, 0, 0, 0);
            z-index: 3;
        }
        .card-container {
            position: absolute;
            height: 240px;
            width: 160px;
            border: 1px solid white;
            border-radius: 5px;
            z-index: 1;
        }
        #btn-roll {
            position: absolute;
            width: 100px;
            height: 50px;
            top: 1515px;
            left: 1464px;
            font-size: 100%;
            z-index: 4;
            cursor: pointer;
        }
        .scoreboard {
            position: absolute;
            top: 257px;
            width: 60px;
            height: 50px;
            font-size: 100%;
        }
        #scoreboard-home { left: 1410px; }
        #scoreboard-away { left: 1552px; }
        #scoreboard-inning { left: 1480px; }
        .pitcher { top: 1200px; }
        .batter-row0 { top: 1500px; }
        .batter-row1 { top: 1800px; }
        .card-l0 { left: 10px; }
        .card-l1 { left: 200px; }
        .card-l2 { left: 390px; }
        .card-l3 { left: 580px; }
        .card-l4 { left: 770px; }
        .card-r0 { left: 2050px; }
        .card-r1 { left: 2240px; }
        .card-r2 { left: 2430px; }
        .card-r3 { left: 2620px; }
        .card-r4 { left: 2810px; }
    </style>
</head>
<body>
    <div id="bg-field"></div>

    <div id="dice-container"></div>
    <button id="btn-roll" onclick="roll()">Roll<span id="roll-result"></span></button>

    <select id="scoreboard-inning" class="scoreboard"></select>
    <select id="scoreboard-home" class="scoreboard scoreboard-score"></select>
    <select id="scoreboard-away" class="scoreboard scoreboard-score"></select>

    <div class="card-container pitcher card-l0"></div>
    <div class="card-container pitcher card-l1"></div>
    <div class="card-container pitcher card-l2"></div>
    <div class="card-container pitcher card-l3"></div>

    <div class="card-container pitcher card-r1"></div>
    <div class="card-container pitcher card-r2"></div>
    <div class="card-container pitcher card-r3"></div>
    <div class="card-container pitcher card-r4"></div>

    <div class="card-container batter-row0 card-l0"></div>
    <div class="card-container batter-row0 card-l1"></div>
    <div class="card-container batter-row0 card-l2"></div>
    <div class="card-container batter-row0 card-l3"></div>
    <div class="card-container batter-row1 card-l0"></div>
    <div class="card-container batter-row1 card-l1"></div>
    <div class="card-container batter-row1 card-l2"></div>
    <div class="card-container batter-row1 card-l3"></div>
    <div class="card-container batter-row1 card-l4"></div>

    <div class="card-container batter-row0 card-r1"></div>
    <div class="card-container batter-row0 card-r2"></div>
    <div class="card-container batter-row0 card-r3"></div>
    <div class="card-container batter-row0 card-r4"></div>
    <div class="card-container batter-row1 card-r0"></div>
    <div class="card-container batter-row1 card-r1"></div>
    <div class="card-container batter-row1 card-r2"></div>
    <div class="card-container batter-row1 card-r3"></div>
    <div class="card-container batter-row1 card-r4"></div>

    <!-- js -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://code.jquery.com/ui/1.14.0/jquery-ui.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui-touch-punch/0.2.3/jquery.ui.touch-punch.min.js"></script>

    <script src="js/three.min.js"></script>
    <script src="js/cannon.min.js"></script>
    <script src="js/teal.js"></script>
    <script src="js/dice.js"></script>

    <script>
        let dice;
        let isRolling = false;

        function roll() {
            if (isRolling) return;
            isRolling = true;
            const vector = { x: (Math.random() * 3 - 1) * dice.w, y: -(Math.random() * 3 - 1) * dice.h };
            const dist = Math.sqrt(vector.x * vector.x + vector.y * vector.y);
            const boost = (Math.random() + 2) * dist;
            const beforeRoll = (_) => {
                $("#roll-result").empty()
            };
            const afterRoll = (notation) => {
                $("#roll-result").html(`: ${notation.resultString}`);
                isRolling = false;
            };
            dice.throw_dices(vector, boost, dist, beforeRoll, afterRoll);
        }

        function initRandomCards(cards) {
            const results = [];
            const chosen = new Set([]);

            const choose = (pos, cls) => {
                const choice = pos + "/" + cards[pos][Math.floor(Math.random() * cards[pos].length)];
                if (chosen.has(choice)) {
                    return choose(pos, cls);
                }
                chosen.add(choice);
                return `<img src="imgs/cards/2025/${choice}.png" class="${cls}">`
            };

            results.push(choose("SP", "card pitcher card-l0"));
            // results.push(choose("RP", "card pitcher card-l1"));
            // results.push(choose("RP", "card pitcher card-l2"));
            // results.push(choose("CP", "card pitcher card-l3"));
            results.push(choose("1B", "card batter-row0 card-l0"));
            results.push(choose("2B", "card batter-row0 card-l1"));
            results.push(choose("3B", "card batter-row0 card-l2"));
            results.push(choose("CA", "card batter-row0 card-l3"));
            results.push(choose("CF", "card batter-row1 card-l0"));
            // results.push(choose("DH", "card batter-row1 card-l1"));
            results.push(choose("LRF", "card batter-row1 card-l2"));
            results.push(choose("LRF", "card batter-row1 card-l3"));
            results.push(choose("SS", "card batter-row1 card-l4"));

            results.push(choose("SP", "card pitcher card-r1"));
            // results.push(choose("RP", "card pitcher card-r2"));
            // results.push(choose("RP", "card pitcher card-r3"));
            // results.push(choose("CP", "card pitcher card-r4"));
            results.push(choose("1B", "card batter-row0 card-r1"));
            results.push(choose("2B", "card batter-row0 card-r2"));
            results.push(choose("3B", "card batter-row0 card-r3"));
            results.push(choose("CA", "card batter-row0 card-r4"));
            results.push(choose("CF", "card batter-row1 card-r0"));
            // results.push(choose("DH", "card batter-row1 card-r1"));
            results.push(choose("LRF", "card batter-row1 card-r2"));
            results.push(choose("LRF", "card batter-row1 card-r3"));
            results.push(choose("SS", "card batter-row1 card-r4"));

            $("body").append(results.join(""));
        }

        async function init() {
            const data = await (await fetch("data.json")).json();
            initRandomCards(data.cards["2025"]);

            const inningOptions = Array.from({ length: 9 }, (_, index) => {
                return `<option ${index === 0 ? "selected" : ""}>${index + 1}</option>`;
            }).join("");
            $("#scoreboard-inning").html(inningOptions);

            const scoreOptions = Array.from({ length: 51 }, (_, index) => {
                return `<option ${index === 0 ? "selected" : ""}>${index}</option>`;
            }).join("");
            $("#scoreboard-home").html(scoreOptions);
            $("#scoreboard-away").html(scoreOptions);

            $(".card").draggable({ snap: ".card-container", snapMode: "inner" });
            dice = new DICE.dice_box(document.querySelector("#dice-container"));
            dice.setDice("1d20");
            window.scrollTo({ top: 580, left: 1075, behavior: "smooth" });
        }

        $(document).ready(init);
    </script>
</body>
